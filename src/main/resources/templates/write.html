<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta name="format-detection"
		content="telephone=no, address=no, email=no" />
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, usrr-scalable=no">
	
	<title>📜 Memo</title>
	
	<link rel="stylesheet" href="/static/bootstrap.min.css" type="text/css" />
	
	<style>
	* {
		box-sizing: border-box;
		margin: 0;
		padding: 0;
	}
	</style>

</head>
<body>
	<div id="wrap" class="container pt-3 pb-3" style="max-width: 800px">
		<div id="header">
			<div class="btn-toolbar mb-3 justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
				<div class="btn-group" role="group" aria-label="First group">
					<a type="button" class="btn btn-outline-secondary" href="/memo/list">Back</a>
				</div>
				<div class="btn-group" role="group" aria-label="Second group">
					<button id="btn_save" type="button" class="btn btn-success">Save</button>
				</div>
			</div>
		</div>
		<hr />
		<form id="content-wrap" action="/memo/view" method="post">
			<div id="content-top" class="d-flex justify-content-between align-items-center">
				<input id="content-title" name="title" class="form-control" placeholder="title..." th:value="${memo.title}" />
			</div>
			<hr />
			<div id="content-body">
				<div id="content-main">
					<textarea id="content-detail" name="content" class="form-control" style="height: 40em;line-height: 1.3;font-size:0.9em;" placeholder="content..." th:text="${memo.content}"></textarea>
					<div id="content-button-wrap"></div>
				</div>
				<input name="locked" style="display: none" value="false" />
				<input name="dir_seq" style="display: none" value="1" />
				<input name="serial" style="display: none" th:value="${memo.serial}" />
			</div>
			<div id="content-bottom"></div>
		</form>
		<hr />
		<div id="footer"></div>
	</div>

	<script th:inline="javascript">
		let ff = false;
		
		document.querySelector("#btn_save").addEventListener("click", (e) => {
			const form = document.querySelector('#content-wrap');

			if(ff) return;

			ff = true;

			const param = {};
			const dataMap = new FormData(form);
			
			for([key, val] of dataMap.entries()) {
				if(key == 'title' && (val == undefined || val == '')) {
					alert("제목을 입력하세요.");
					return;
				}

				param[key] = val;
			}

			fetch("/api/memo/save", {
					method: "POST",
					cache: "no-cache",
					credentials: "same-origin",
					headers: { "Content-Type": "application/json"},
					body: JSON.stringify(param),
			}).then(res => res.json())
			.then(data => {
				if(data?.serial !== '' || data?.serial !== undefined) {
					location.replace('/memo/view/' + data.serial);
				}
				// TODO error 처리
			})
		})
	</script>
</body>
</html>